#!/bin/bash

WORDLIST_PATH="/root/wordlists/apk_code_grep.txt"
USAGE="Script - was created to extract interesting patterns from Smali code in apk\n
	  USAGE=./grep_extractor.sh INPUT_DIR OUTPUT_DIR\n
	  INPUT_DIR : Directory to search patterns\n
	  OUTPUT_DIR : where to output grep's results\n
	  This script uses the wordlist located in $WORDLIST_PATH. \nChange it to whatever you like."

# exit if less than 2 args given
if [[ $# -ne 2 ]]; then
	echo -n $USAGE
	exit 1
fi

INPUT_DIR=$1
OUTPUT_DIR=$2

# Check if input dir exists
if  [ ! -d "$INPUT_DIR" ]; then
        echo "$INPUT_DIR Doesn't Exist" >&2
        exit 1
fi

# Create output dir if it isn't exists
if  [ ! -d "$OUTPUT_DIR" ]; then
        echo "$OUTPUT_DIR Doesn't Exist\n Creating one."
        mkdir $OUTPUT_DIR
fi



extract_pattern(){
	$pattern=$1
	result=$(grep -rFi $pattern $INPUT_DIR)
	if result
		echo "[!] Found $1 patterns! Extracting..."
		echo $result >"$OUTPUT_DIR/grep-$pattern.txt"
}

# Loop wordlist and extract patterns to separate files
cat $WORDLIST_PATH | while read pattern; do
  echo "Searching $pattern".
  extract_pattern($pattern)
done